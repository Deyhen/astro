---
import './lead-modal.css';
---

<div
  id="lead-modal-backdrop"
  class="lead-modal-backdrop"
  role="dialog"
  aria-modal="true"
  aria-labelledby="lead-modal-title"
  aria-hidden="true"
>
  <div class="lead-modal" data-modal-inner>
    <!-- Кнопка закрытия -->
    <button type="button" class="lead-close-btn" data-close-lead aria-label="Закрыть форму">
      ✕
    </button>

    <h2 id="lead-modal-title" class="lead-modal-title">
      Оставьте заявку —<br class="hidden md:block" />
      привезём авто из Европы под ключ
    </h2>

    <p class="lead-modal-subtitle">
      Расскажите, какой автомобиль вы ищете — мы подберём лучшие варианты и рассчитаем стоимость с
      доставкой и оформлением.
    </p>

    <form class="lead-modal-form">
      <div class="controls">
        <!-- Имя -->
        <label class="sr-only" for="lead-name">Ваше имя</label>
        <input id="lead-name" name="name" type="text" class="lead-input" placeholder="Ваше имя" />

        <!-- Телефон -->
        <label class="sr-only" for="lead-phone">Телефон</label>
        <div class="lead-phone-field">
          <input
            id="lead-phone"
            name="phone"
            type="tel"
            class="lead-phone-input"
            placeholder="+38 (00) 000-00-00"
          />
        </div>

        <!-- Марка / модель -->
        <label class="sr-only" for="lead-car">Марка / модель авто</label>
        <input
          id="lead-car"
          name="car"
          type="text"
          class="lead-input"
          placeholder="Марка / модель авто"
        />
      </div>

      <button type="submit" class="lead-submit"> Отправить заявку </button>
    </form>

    <p class="lead-consent">
      Отправляя заявку, вы даете свое согласие<br />
      на
      <a href="/Policy" target="_blank" rel="noopener noreferrer">
        обработку персональных данных
      </a>
      .
    </p>
  </div>
</div>

<script is:inline>
  const backdrop = document.getElementById('lead-modal-backdrop');

  function openLeadModal() {
    if (!backdrop) return;
    backdrop.classList.add('open');
    backdrop.setAttribute('aria-hidden', 'false');
  }

  function closeLeadModal() {
    if (!backdrop) return;
    backdrop.classList.remove('open');
    backdrop.setAttribute('aria-hidden', 'true');
  }

  // Открытие по любому элементу с data-open-lead
  document.querySelectorAll('[data-open-lead]').forEach((el) => {
    el.addEventListener('click', (e) => {
      e.preventDefault();
      openLeadModal();
    });
  });

  // Закрытие по крестику
  backdrop?.querySelectorAll('[data-close-lead]').forEach((el) => {
    el.addEventListener('click', () => closeLeadModal());
  });

  // Клик по фону (но не по самой карточке)
  backdrop?.addEventListener('click', (e) => {
    if (e.target === backdrop) closeLeadModal();
  });

  // Esc
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') closeLeadModal();
  });
</script>
